<!--DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    < Impedir a execu√ß√£o de scripts externos >
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'">
    < T√≠tulo da janela >
    <title>Sticky Notes</title>
    < Bootstrap>
    <link rel="stylesheet" href="../public/css/bootstrap.min.css">
    < CSS Personalizado ATEN√á√ÉO!!! sempre ap√≥s o CSS do bootstrap >
    <link rel="stylesheet" href="../public/css/style.css">
</head>

<body>
    <div class="container">
        
       
    </div>

    <footer>
        <p id="dataAtual"></p>
        <img src="../public/img/dboff.png" alt="icone banco de dados" id="iconeDB">
    </footer>

    < Bootstrap>
    <script src="../public/js/bootstrap.min.js"></script>

    < Processo de renderiza√ß√£o >
    <script src="renderer.js"></script>
    <script src="rendererSobre.js"></script>
</body>

</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'">
  <title>Sticky Notes</title>
  <!Bootstrap CSS via CDN -->
  <!DOCTYPE html>
  <html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Cadastro de Clientes</title>
    <link rel="stylesheet" href="../public/css/bootstrap.min.css">
    <link rel="stylesheet" href="../public/css/style.css">
    <style>
      body, html { height: 100%; margin: 0; overflow: hidden; background-color: #d3d4d5; }
      .container { height: calc(100% - 60px); display: flex; align-items: center; justify-content: center; padding: 10px; }
      .form-container { max-width: 900px; width: 100%; padding: 15px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
      .form-container h1 { font-size: 1.5rem; margin-bottom: 15px; color: #212529; }
      .form-group { margin-bottom: 10px; }
      .form-label { font-size: 0.9rem; margin-bottom: 2px; color: #212529; font-weight: 500; }
      .form-control, .form-select { font-size: 0.9rem; padding: 5px; height: 35px; color: #212529; background-color: #fff; border: 1px solid #495057; }
      .form-control:focus, .form-select:focus { border-color: #007bff; box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); }
      .btn { font-size: 0.9rem; padding: 6px 12px; }
      footer { height: 60px; padding: 10px; position: fixed; bottom: 0; width: 100%; background-color: #e9ecef; display: flex; justify-content: space-between; border-top: 1px solid #dee2e6; }
      footer p { font-size: 1rem; margin: 5px 0 0 5px; color: #212529; }
      .search-group { position: relative; margin-bottom: 20px; }
      .search-group input { padding-left: 30px; }
      .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #6c757d; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-container">
        <h1 class="text-center">Cadastro de Clientes</h1>
        
        <!-- Campo de busca com √≠cone de lupa -->
        <div class="search-group">
          <span class="search-icon">üîç</span>
          <input type="text" class="form-control" id="buscar" name="buscar" placeholder="Buscar por CPF ou Nome">
        </div>
  
        <form id="cadastroForm" class="needs-validation">
          <div class="row g-2">
            <div class="col-md-6 form-group">
              <label for="nomeCompleto" class="form-label">Nome Completo <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="nomeCompleto" name="nomeCompleto" required>
              <div class="invalid-feedback">Nome completo √© obrigat√≥rio.</div>
            </div>
            <div class="col-md-6 form-group">
              <label for="nomePreferencial" class="form-label">Nome Preferencial</label>
              <input type="text" class="form-control" id="nomePreferencial" name="nomePreferencial">
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-4 form-group">
              <label for="dataNascimento" class="form-label">Data Nascimento <span class="text-danger">*</span></label>
              <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" required>
              <div class="invalid-feedback">Data √© obrigat√≥ria.</div>
            </div>
            <div class="col-md-4 form-group">
              <label for="genero" class="form-label">G√™nero</label>
              <select class="form-select" id="genero" name="genero">
                <option value="">Prefiro n√£o informar</option>
                <option value="masculino">Masculino</option>
                <option value="feminino">Feminino</option>
                <option value="outro">Outro</option>
              </select>
            </div>
            <div class="col-md-4 form-group">
              <label for="cpf" class="form-label">CPF <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="cpf" name="cpf" required pattern="\d{3}\.\d{3}\.\d{3}-\d{2}">
              <div class="invalid-feedback">CPF inv√°lido (ex.: 123.456.789-00).</div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-6 form-group">
              <label for="email" class="form-label">E-mail <span class="text-danger">*</span></label>
              <input type="email" class="form-control" id="email" name="email" required>
              <div class="invalid-feedback">E-mail inv√°lido.</div>
            </div>
            <div class="col-md-3 form-group">
              <label for="telefoneCelular" class="form-label">Celular <span class="text-danger">*</span></label>
              <input type="tel" class="form-control" id="telefoneCelular" name="telefoneCelular" required pattern="\(\d{2}\)\s\d{5}-\d{4}">
              <div class="invalid-feedback">Ex.: (11) 98765-4321</div>
            </div>
            <div class="col-md-3 form-group">
              <label for="telefoneFixo" class="form-label">Fixo</label>
              <input type="tel" class="form-control" id="telefoneFixo" name="telefoneFixo" pattern="\(\d{2}\)\s\d{4}-\d{4}">
              <div class="invalid-feedback">Ex.: (11) 1234-5678</div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-3 form-group">
              <label for="cep" class="form-label">CEP <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="cep" name="cep" required pattern="\d{5}-\d{3}">
              <div class="invalid-feedback">Ex.: 12345-678</div>
            </div>
            <div class="col-md-6 form-group">
              <label for="logradouro" class="form-label">Logradouro <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="logradouro" name="logradouro" required>
              <div class="invalid-feedback">Logradouro √© obrigat√≥rio.</div>
            </div>
            <div class="col-md-3 form-group">
              <label for="numero" class="form-label">N√∫mero <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="numero" name="numero" required>
              <div class="invalid-feedback">N√∫mero √© obrigat√≥rio.</div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-4 form-group">
              <label for="complemento" class="form-label">Complemento</label>
              <input type="text" class="form-control" id="complemento" name="complemento">
            </div>
            <div class="col-md-4 form-group">
              <label for="bairro" class="form-label">Bairro <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="bairro" name="bairro" required>
              <div class="invalid-feedback">Bairro √© obrigat√≥rio.</div>
            </div>
            <div class="col-md-2 form-group">
              <label for="estado" class="form-label">Estado <span class="text-danger">*</span></label>
              <select class="form-select" id="estado" name="estado" required>
                <option value="">Selecione</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
              </select>
              <div class="invalid-feedback">Estado √© obrigat√≥rio.</div>
            </div>
            <div class="col-md-2 form-group">
              <label for="cidade" class="form-label">Cidade <span class="text-danger">*</span></label>
              <select class="form-select" id="cidade" name="cidade" required>
                <option value="">Selecione</option>
              </select>
              <div class="invalid-feedback">Cidade √© obrigat√≥ria.</div>
            </div>
          </div>
          <div class="row g-2">
            <div class="col-md-12 form-group d-flex justify-content-end gap-2 mt-3">
              <button type="submit" id="btnSalvar" class="btn btn-outline-success">Salvar</button>
              <button type="submit" id="btnEditar" class="btn btn-outline-warning">Editar</button>
              <button type="button" id="btnExcluir" class="btn btn-outline-danger">Excluir</button>
              <button type="reset" id="btnLimpar" class="btn btn-outline-primary" onclick="resetForm()"></button>
            </div>
          </div>
        </form>
      </div>
    </div>
  
    <footer>
      <p id="dataAtual"></p>
      <img src="../public/img/dboff.png" alt="icone banco de dados" id="iconeDB">
    </footer>
  
    <script src="../public/js/bootstrap.bundle.min.js"></script>
    <script src="../public/js/inputmask.min.js"></script>
    <script>
      // M√°scaras de entrada
      Inputmask({"mask": "999.999.999-99"}).mask(document.getElementById("cpf"));
      Inputmask({"mask": "99999-999"}).mask(document.getElementById("cep"));
      Inputmask({"mask": "(99) 99999-9999"}).mask(document.getElementById("telefoneCelular"));
      Inputmask({"mask": "(99) 9999-9999"}).mask(document.getElementById("telefoneFixo"));
  
      // Valida√ß√£o de CPF
      function validarCPF(cpf) {
        cpf = cpf.replace(/[^\d]+/g, '');
        if (cpf.length !== 11) return false;
        if (/^(\d)\1+$/.test(cpf)) return false;
        let soma = 0;
        let resto;
        for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i - 1, i)) * (11 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        if (resto !== parseInt(cpf.substring(9, 10))) return false;
        soma = 0;
        for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i - 1, i)) * (12 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        if (resto !== parseInt(cpf.substring(10, 11))) return false;
        return true;
      }
  
      // Consulta CEP via ViaCEP
      async function consultarCEP(cep) {
        cep = cep.replace(/\D/g, '');
        if (cep.length !== 8) return;
        try {
          const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
          const data = await response.json();
          if (!data.erro) {
            document.getElementById('logradouro').value = data.logradouro;
            document.getElementById('bairro').value = data.bairro;
            document.getElementById('estado').value = data.uf;
            await carregarCidades(data.uf);
            document.getElementById('cidade').value = data.localidade;
          }
        } catch (error) {
          console.error('Erro ao consultar CEP:', error);
        }
      }
  
      // Carregar cidades por estado
      async function carregarCidades(uf) {
        try {
          const response = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`);
          const cidades = await response.json();
          const cidadeSelect = document.getElementById('cidade');
          cidadeSelect.innerHTML = '<option value="">Selecione</option>';
          cidades.forEach(cidade => {
            const option = document.createElement('option');
            option.value = cidade.nome;
            option.textContent = cidade.nome;
            cidadeSelect.appendChild(option);
          });
        } catch (error) {
          console.error('Erro ao carregar cidades:', error);
        }
      }
  
      // Valida√ß√£o em tempo real
      document.querySelectorAll('.form-control, .form-select').forEach(input => {
        input.addEventListener('input', function() {
          const feedback = this.nextElementSibling;
          if (this.id === 'cpf') {
            const isValid = validarCPF(this.value);
            this.classList.toggle('is-valid', isValid);
            this.classList.toggle('is-invalid', !isValid);
            if (feedback) feedback.style.display = isValid ? 'none' : 'block';
          } else if (this.id === 'cep') {
            const isValid = /^\d{5}-\d{3}$/.test(this.value);
            this.classList.toggle('is-valid', isValid);
            this.classList.toggle('is-invalid', !isValid);
            if (feedback) feedback.style.display = isValid ? 'none' : 'block';
            if (isValid) consultarCEP(this.value);
          } else if (this.id === 'email') {
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value);
            this.classList.toggle('is-valid', isValid);
            this.classList.toggle('is-invalid', !isValid);
            if (feedback) feedback.style.display = isValid ? 'none' : 'block';
          } else if (this.required && !this.value.trim()) {
            this.classList.add('is-invalid');
            this.classList.remove('is-valid');
            if (feedback) feedback.style.display = 'block';
          } else {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
            if (feedback) feedback.style.display = 'none';
          }
        });
      });
  
      // Carregar cidades ao mudar estado
      document.getElementById('estado').addEventListener('change', function() {
        if (this.value) {
          carregarCidades(this.value);
          this.classList.add('is-valid');
          this.classList.remove('is-invalid');
        }
      });
  
      // Bot√£o Salvar
      document.getElementById('btnSalvar').addEventListener('click', () => {
        const form = document.getElementById('cadastroForm');
        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          return;
        }
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        if (window.electronAPI && window.electronAPI.saveClient) {
          window.electronAPI.saveClient(data);
        } else {
          console.error("API do Electron n√£o dispon√≠vel");
          alert("Erro: N√£o foi poss√≠vel salvar o cliente.");
        }
      });
  
      // Bot√£o Editar
      document.getElementById('btnEditar').addEventListener('click', () => {
        const form = document.getElementById('cadastroForm');
        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          return;
        }
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        if (window.electronAPI && window.electronAPI.updateClient) {
          window.electronAPI.updateClient(data);
        } else {
          console.error("API do Electron n√£o dispon√≠vel");
          alert("Erro: N√£o foi poss√≠vel editar o cliente.");
        }
      });
  
      // Bot√£o Excluir
      document.getElementById('btnExcluir').addEventListener('click', () => {
        const cpf = document.getElementById('cpf').value;
        if (!cpf || !validarCPF(cpf)) {
          alert('Por favor, insira um CPF v√°lido para excluir.');
          return;
        }
        if (window.electronAPI && window.electronAPI.removeClient) {
          window.electronAPI.removeClient(cpf);
        } else {
          console.error("API do Electron n√£o dispon√≠vel");
          alert("Erro: N√£o foi poss√≠vel excluir o cliente.");
        }
      });
  
      // Bot√£o Limpar
      document.getElementById('btnLimpar').addEventListener('click', () => {
        const form = document.getElementById('cadastroForm');
        form.reset();
        form.classList.remove('was-validated');
        document.getElementById('cidade').innerHTML = '<option value="">Selecione</option>';
        document.getElementById('buscar').focus(); // Volta o foco para o campo de busca
      });
  
      // Resposta do salvamento
      if (window.electronAPI && window.electronAPI.onSaveClientResponse) {
        window.electronAPI.onSaveClientResponse((response) => {
          alert(response.message);
          if (response.success) {
            const form = document.getElementById('cadastroForm');
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('cidade').innerHTML = '<option value="">Selecione</option>';
            document.getElementById('buscar').focus(); // Volta o foco para o campo de busca
          }
        });
      }
  
      // Resposta da edi√ß√£o
      if (window.electronAPI && window.electronAPI.updateClientResponse) {
        window.electronAPI.updateClientResponse((response) => {
          alert(response.message);
          if (response.success) {
            const form = document.getElementById('cadastroForm');
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('cidade').innerHTML = '<option value="">Selecione</option>';
            document.getElementById('buscar').focus(); // Volta o foco para o campo de busca
          }
        });
      }
  
      // Resposta da exclus√£o
      if (window.electronAPI && window.electronAPI.removeClientResponse) {
        window.electronAPI.removeClientResponse((response) => {
          alert(response.message);
          if (response.success) {
            const form = document.getElementById('cadastroForm');
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('cidade').innerHTML = '<option value="">Selecione</option>';
            document.getElementById('buscar').focus(); // Volta o foco para o campo de busca
          }
        });
      }
  
      // Fun√ß√£o para atualizar a data e hora
      function atualizarDataHora() {
        const dataAtual = document.getElementById('dataAtual');
        const agora = new Date();
        const data = agora.toLocaleDateString('pt-BR');
        const hora = agora.toLocaleTimeString('pt-BR', { hour12: false });
        dataAtual.textContent = `${data}     ${hora}`;
      }
  
      // Data atual no footer e status do banco
      document.addEventListener('DOMContentLoaded', () => {
        atualizarDataHora();
        setInterval(atualizarDataHora, 1000);
  
        if (window.electronAPI && window.electronAPI.requestDbStatus) {
          window.electronAPI.requestDbStatus();
          window.electronAPI.onDbStatus((message) => {
            const iconeDB = document.getElementById('iconeDB');
            iconeDB.src = message === 'conectado' ? 
              window.electronAPI.getImagePath('dbon.png') : 
              window.electronAPI.getImagePath('dboff.png');
          });
        }
  
        // Define o foco no campo de busca ao carregar a p√°gina
        document.getElementById('buscar').focus();
      });
  
      // Fun√ß√£o de busca (exemplo b√°sico)
      document.getElementById('buscar').addEventListener('input', (e) => {
        const termo = e.target.value.toLowerCase();
        if (termo.length >= 3 && window.electronAPI && window.electronAPI.searchClient) {
          window.electronAPI.searchClient(termo);
        }
      });
  
      // Resposta da busca
      if (window.electronAPI && window.electronAPI.onSearchClientResponse) {
        window.electronAPI.onSearchClientResponse((response) => {
          if (response.success && response.data) {
            const form = document.getElementById('cadastroForm');
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('cidade').innerHTML = '<option value="">Selecione</option>';
            
            // Preenche os campos com os dados encontrados
            document.getElementById('nomeCompleto').value = response.data.nomeCompleto || '';
            document.getElementById('nomePreferencial').value = response.data.nomePreferencial || '';
            document.getElementById('dataNascimento').value = response.data.dataNascimento || '';
            document.getElementById('genero').value = response.data.genero || '';
            document.getElementById('cpf').value = response.data.cpf || '';
            document.getElementById('email').value = response.data.email || '';
            document.getElementById('telefoneCelular').value = response.data.telefoneCelular || '';
            document.getElementById('telefoneFixo').value = response.data.telefoneFixo || '';
            document.getElementById('cep').value = response.data.cep || '';
            document.getElementById('logradouro').value = response.data.logradouro || '';
            document.getElementById('numero').value = response.data.numero || '';
            document.getElementById('complemento').value = response.data.complemento || '';
            document.getElementById('bairro').value = response.data.bairro || '';
            document.getElementById('estado').value = response.data.estado || '';
            if (response.data.estado) carregarCidades(response.data.estado).then(() => {
              document.getElementById('cidade').value = response.data.cidade || '';
            });
          } else {
            alert(response.message || 'Nenhum cliente encontrado.');
          }
        });
      }
    </script>
  </body>
  </html>